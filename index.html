<!DOCTYPE html>

<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#667eea">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="å»ºè¨­æ©Ÿæ¢°ç‚¹æ¤œ">
    <link rel="manifest" href="manifest.json">
    <title>å»ºè¨­æ©Ÿæ¢°ä½¿ç”¨å‰ç‚¹æ¤œè¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ ï¼ˆæ”¹å–„ç‰ˆï¼‰</title>

```
<!-- SheetJS for Excel export -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    body {
        font-family: 'Meiryo', 'MS Gothic', sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1600px;
        margin: 0 auto;
        background: white;
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 30px;
        text-align: center;
        position: relative;
    }

    .header h1 {
        font-size: 28px;
        margin-bottom: 10px;
    }

    .header p {
        font-size: 14px;
        opacity: 0.9;
    }

    .pwa-install-banner {
        background: rgba(255,255,255,0.2);
        padding: 12px 20px;
        border-radius: 10px;
        margin-top: 15px;
        display: none;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
    }

    .pwa-install-banner.show {
        display: flex;
    }

    .pwa-install-btn {
        background: white;
        color: #667eea;
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        cursor: pointer;
        font-weight: bold;
        font-size: 14px;
    }

    .backup-status {
        position: absolute;
        top: 15px;
        right: 15px;
        background: rgba(255,255,255,0.2);
        padding: 8px 15px;
        border-radius: 20px;
        font-size: 12px;
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .backup-status:hover {
        background: rgba(255,255,255,0.3);
        transform: scale(1.05);
    }

    .backup-status.success {
        background: rgba(76, 175, 80, 0.3);
    }

    .backup-status.warning {
        background: rgba(255, 152, 0, 0.3);
    }

    .tabs {
        display: flex;
        background: #f5f5f5;
        border-bottom: 2px solid #ddd;
        overflow-x: auto;
    }

    .tab {
        flex: 1;
        min-width: 150px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
        background: #f5f5f5;
        border: none;
        font-size: 15px;
        font-weight: bold;
        transition: all 0.3s;
        color: #666;
    }

    .tab:hover {
        background: #e0e0e0;
    }

    .tab.active {
        background: white;
        color: #667eea;
        border-bottom: 3px solid #667eea;
    }

    .content {
        padding: 30px;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
        animation: fadeIn 0.3s;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .section {
        background: #f9f9f9;
        padding: 25px;
        border-radius: 10px;
        margin-bottom: 25px;
        border: 1px solid #e0e0e0;
    }

    .section h2 {
        color: #667eea;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #667eea;
        font-size: 20px;
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
        color: #333;
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
        transition: border 0.3s;
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
        outline: none;
        border-color: #667eea;
    }

    .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 14px 30px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: bold;
        transition: transform 0.2s, box-shadow 0.2s;
        margin-right: 10px;
        margin-bottom: 10px;
    }

    .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    }

    .btn-secondary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    .btn-success {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .btn-warning {
        background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
    }

    .btn-danger {
        background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
    }

    .btn-excel {
        background: linear-gradient(135deg, #1e7e34 0%, #28a745 100%);
    }

    .btn-small {
        padding: 8px 15px;
        font-size: 14px;
    }

    .master-list {
        list-style: none;
    }

    .master-item {
        background: white;
        padding: 15px;
        margin-bottom: 10px;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .master-info {
        flex: 1;
    }

    .master-info strong {
        color: #667eea;
        font-size: 16px;
    }

    .master-info span {
        color: #666;
        margin-left: 15px;
    }

    .master-info .detail {
        display: block;
        margin-top: 5px;
        font-size: 14px;
        color: #888;
    }

    .inspection-form {
        background: white;
        padding: 20px;
        border-radius: 10px;
    }

    .inspection-category {
        margin-bottom: 30px;
    }

    .inspection-category h3 {
        background: #667eea;
        color: white;
        padding: 12px;
        border-radius: 6px;
        margin-bottom: 15px;
        font-size: 18px;
    }

    .inspection-item {
        display: grid;
        grid-template-columns: 200px 300px 1fr;
        gap: 15px;
        padding: 15px;
        background: #f9f9f9;
        margin-bottom: 10px;
        border-radius: 6px;
        align-items: center;
    }

    .inspection-item label {
        font-weight: bold;
        color: #333;
    }

    .inspection-item .check-description {
        color: #666;
        font-size: 13px;
    }

    .inspection-item select {
        padding: 8px;
        border: 2px solid #ddd;
        border-radius: 6px;
        font-size: 14px;
    }

    .report-page {
        page-break-after: always;
        background: white;
        padding: 20px;
        margin-bottom: 30px;
        border: 1px solid #ddd;
        border-radius: 10px;
    }

    .report-page:last-child {
        page-break-after: auto;
    }

    .report-title {
        text-align: center;
        font-size: 24px;
        font-weight: bold;
        margin-bottom: 30px;
        padding: 15px;
        border: 3px solid #333;
    }

    .report-info-table {
        width: 100%;
        margin-bottom: 20px;
        border-collapse: collapse;
    }

    .report-info-table td {
        padding: 8px;
        border: 1px solid #333;
    }

    .report-info-table .label {
        background: #f0f0f0;
        font-weight: bold;
        width: 150px;
    }

    .report-main-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 11px;
    }

    .report-main-table th,
    .report-main-table td {
        border: 1px solid #333;
        padding: 6px 4px;
        text-align: center;
    }

    .report-main-table th {
        background: #e0e0e0;
        font-weight: bold;
    }

    .report-main-table .category-cell {
        background: #f5f5f5;
        font-weight: bold;
        text-align: center;
        vertical-align: middle;
        writing-mode: vertical-rl;
        text-orientation: upright;
    }

    .report-main-table .subcategory-cell {
        background: #fafafa;
        font-weight: bold;
        text-align: center;
        vertical-align: middle;
    }

    .report-main-table .item-cell {
        text-align: left;
        padding-left: 10px;
        font-size: 10px;
    }

    .report-main-table .day-cell {
        width: 30px;
        font-size: 14px;
        font-weight: bold;
    }

    .report-main-table .status-ok {
        background: #d4edda;
        color: #155724;
        font-weight: bold;
    }

    .report-main-table .status-ng {
        background: #f8d7da;
        color: #721c24;
        font-weight: bold;
    }

    .report-footer {
        margin-top: 20px;
        padding: 15px;
        border: 2px solid #333;
    }

    .report-footer p {
        margin: 5px 0;
        font-size: 12px;
    }

    .report-footer .sign-row {
        margin-top: 15px;
        border-top: 1px solid #333;
        padding-top: 10px;
    }

    /* ã‚¹ãƒ¯ã‚¤ãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
    .swipe-navigation {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(102, 126, 234, 0.95);
        padding: 15px 25px;
        border-radius: 50px;
        display: none;
        align-items: center;
        gap: 20px;
        z-index: 1000;
        box-shadow: 0 5px 20px rgba(0,0,0,0.3);
    }

    .swipe-navigation.show {
        display: flex;
    }

    /* ã‚¯ã‚¤ãƒƒã‚¯å…±æœ‰ãƒœã‚¿ãƒ³ */
    .quick-share-btn {
        position: fixed;
        bottom: 100px;
        right: 20px;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #00d2ff 0%, #3a47d5 100%);
        color: white;
        border: none;
        font-size: 28px;
        cursor: pointer;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
    }

    .quick-share-btn:hover {
        transform: scale(1.1);
        box-shadow: 0 6px 25px rgba(0, 0, 0, 0.4);
    }

    .quick-share-btn:active {
        transform: scale(0.95);
    }

    @media (min-width: 769px) {
        .quick-share-btn {
            display: none;
        }
    }

    .swipe-btn {
        background: white;
        color: #667eea;
        border: none;
        width: 45px;
        height: 45px;
        border-radius: 50%;
        font-size: 20px;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s;
    }

    .swipe-btn:hover {
        transform: scale(1.1);
    }

    .swipe-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    .swipe-info {
        color: white;
        font-weight: bold;
        font-size: 16px;
        min-width: 80px;
        text-align: center;
    }

    @media print {
        body {
            background: white;
            padding: 0;
        }

        .container {
            box-shadow: none;
            border-radius: 0;
            max-width: 100%;
        }

        .header,
        .tabs,
        .btn,
        .no-print,
        .swipe-navigation {
            display: none !important;
        }

        .content {
            padding: 0;
        }

        .report-page {
            margin-bottom: 0;
            border: none;
            border-radius: 0;
            page-break-after: always;
        }

        .report-page:last-child {
            page-break-after: auto;
        }

        .report-main-table {
            font-size: 9px;
        }

        .report-main-table th,
        .report-main-table td {
            padding: 3px 2px;
        }
    }

    .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
    }

    .alert-success {
        background: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
    }

    .alert-info {
        background: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
    }

    .alert-warning {
        background: #fff3cd;
        color: #856404;
        border: 1px solid #ffeaa7;
    }

    .filters {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-bottom: 20px;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.5);
    }

    .modal.show {
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-content {
        background: white;
        padding: 30px;
        border-radius: 15px;
        max-width: 600px;
        width: 90%;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-header {
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #667eea;
    }

    .modal-header h2 {
        color: #667eea;
    }

    .modal-footer {
        margin-top: 20px;
        text-align: right;
    }

    .loading {
        text-align: center;
        padding: 50px;
        color: #667eea;
    }

    .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* ã‚¹ãƒãƒ›å¯¾å¿œ */
    @media (max-width: 768px) {
        body {
            padding: 10px;
        }

        .header h1 {
            font-size: 22px;
        }

        .header p {
            font-size: 13px;
        }

        .tab {
            min-width: 120px;
            padding: 16px 10px;
            font-size: 14px;
        }

        .content {
            padding: 15px;
        }

        .section {
            padding: 15px;
            margin-bottom: 15px;
        }

        .section h2 {
            font-size: 18px;
        }

        .form-group label {
            font-size: 15px;
            margin-bottom: 10px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 14px;
            font-size: 16px;
            min-height: 48px;
        }

        .form-group textarea {
            min-height: 100px;
        }

        .btn {
            padding: 16px 24px;
            font-size: 16px;
            min-height: 50px;
            width: 100%;
            margin-right: 0;
            margin-bottom: 12px;
        }

        .btn-small {
            padding: 12px 18px;
            font-size: 15px;
            min-height: 44px;
            width: auto;
        }

        .master-item {
            flex-direction: column;
            align-items: flex-start;
            padding: 12px;
        }

        .master-info {
            width: 100%;
            margin-bottom: 10px;
        }

        .master-info strong {
            font-size: 16px;
            display: block;
            margin-bottom: 5px;
        }

        .master-info span {
            margin-left: 0;
            display: block;
            margin-top: 5px;
        }

        .inspection-item {
            grid-template-columns: 1fr;
            gap: 10px;
            padding: 15px;
        }

        .inspection-item label {
            font-size: 16px;
        }

        .inspection-item .check-description {
            font-size: 14px;
            margin-top: 5px;
        }

        .inspection-item select {
            padding: 14px;
            font-size: 16px;
            min-height: 48px;
        }

        .report-info-table {
            font-size: 14px;
        }

        .report-info-table td {
            padding: 10px 8px;
        }

        .inspection-category h3 {
            font-size: 16px;
            padding: 12px 10px;
        }

        .report-page {
            transform: scale(0.35);
            transform-origin: top left;
            width: 285%;
            margin-bottom: 20px;
        }

        .swipe-navigation {
            bottom: 80px;
            padding: 12px 20px;
        }

        .quick-share-btn {
            bottom: 160px;
            right: 15px;
            width: 55px;
            height: 55px;
            font-size: 24px;
        }

        .swipe-btn {
            width: 40px;
            height: 40px;
            font-size: 18px;
        }

        .swipe-info {
            font-size: 14px;
            min-width: 60px;
        }
    }

    @media (max-width: 480px) {
        .header h1 {
            font-size: 20px;
        }

        .tab {
            min-width: 100px;
            padding: 14px 8px;
            font-size: 13px;
        }

        .section h2 {
            font-size: 16px;
        }

        .btn {
            font-size: 15px;
            padding: 14px 20px;
        }

        .inspection-item label {
            font-size: 15px;
        }

        .master-info strong {
            font-size: 15px;
        }
    }
</style>
```

</head>
<body>
    <div id="mainApp">
        <div class="container">
            <div class="header">
                <div class="backup-status" id="backupStatus" onclick="shareData()" title="ã‚¯ãƒªãƒƒã‚¯ã—ã¦å…±æœ‰">
                    ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å¾…æ©Ÿä¸­
                </div>

```
            <h1>ğŸšœ å»ºè¨­æ©Ÿæ¢°ä½¿ç”¨å‰ç‚¹æ¤œè¨˜éŒ²ã‚·ã‚¹ãƒ†ãƒ </h1>
            <p>æ©Ÿæ¢°ã®æ—¥ã€…ã®ç‚¹æ¤œã‚’ç°¡å˜ã«è¨˜éŒ²ãƒ»ç®¡ç†ã§ãã¾ã™ï¼ˆæ”¹å–„ç‰ˆ v2.1ï¼‰</p>
            
            <div class="pwa-install-banner" id="pwaInstallBanner">
                <span>ğŸ“± ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã—ã¦ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ãˆã¾ã™ï¼</span>
                <button class="pwa-install-btn" id="pwaInstallBtn">è¿½åŠ ã™ã‚‹</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">ğŸ”§ æ©Ÿæ¢°ãƒã‚¹ã‚¿ãƒ¼</button>
            <button class="tab" onclick="switchTab(1)">ğŸ—ï¸ å·¥äº‹ãƒã‚¹ã‚¿ãƒ¼</button>
            <button class="tab" onclick="switchTab(2)">ğŸ‘¤ æ‹…å½“è€…ãƒã‚¹ã‚¿ãƒ¼</button>
            <button class="tab" onclick="switchTab(3)">âœï¸ ç‚¹æ¤œå…¥åŠ›</button>
            <button class="tab" onclick="switchTab(4)">ğŸ“Š æœˆæ¬¡ç‚¹æ¤œç°¿</button>
        </div>

        <div class="content">
            <!-- ã‚¿ãƒ–1: æ©Ÿæ¢°ãƒã‚¹ã‚¿ãƒ¼ -->
            <div class="tab-content active" id="tab-0">
                <div class="section">
                    <h2>æ©Ÿæ¢°ãƒã‚¹ã‚¿ãƒ¼ç™»éŒ²</h2>
                    <form id="machineForm" onsubmit="addMachine(event)">
                        <div class="form-group">
                            <label for="machineName">æ©Ÿæ¢°åç§° *</label>
                            <input type="text" id="machineName" required placeholder="ä¾‹: PC78UU BH0.25ã¥ ã‚¯ãƒ¬ãƒ¼ãƒ³ä»•æ§˜">
                        </div>
                        <div class="form-group">
                            <label for="machineClass">éšç´š *</label>
                            <input type="text" id="machineClass" required placeholder="ä¾‹: 0.25ã¥ç´š">
                        </div>
                        <div class="form-group">
                            <label for="machineNote">å‚™è€ƒ</label>
                            <textarea id="machineNote" rows="3" placeholder="ãã®ä»–ã®æƒ…å ±ãŒã‚ã‚Œã°è¨˜å…¥"></textarea>
                        </div>
                        <button type="submit" class="btn">â• æ©Ÿæ¢°ã‚’ç™»éŒ²</button>
                    </form>
                </div>

                <div class="section">
                    <h2>ç™»éŒ²æ¸ˆã¿æ©Ÿæ¢°ä¸€è¦§</h2>
                    <ul class="master-list" id="machineList"></ul>
                </div>
            </div>

            <!-- ã‚¿ãƒ–2: å·¥äº‹ãƒã‚¹ã‚¿ãƒ¼ -->
            <div class="tab-content" id="tab-1">
                <div class="section">
                    <h2>å·¥äº‹ãƒã‚¹ã‚¿ãƒ¼ç™»éŒ²</h2>
                    <form id="projectForm" onsubmit="addProject(event)">
                        <div class="form-group">
                            <label for="projectName">å·¥äº‹å *</label>
                            <input type="text" id="projectName" required placeholder="ä¾‹: çµŒå–¶ä½“è‚²æˆåŸºç›¤æ•´å‚™äº‹æ¥­ï¼ˆåœŸåœ°ç·ï¼‰é‡åŸåœ°åŒºç¬¬ï¼‘å·å·¥äº‹">
                        </div>
                        <div class="form-group">
                            <label for="projectLocation">å·¥äº‹ç®‡æ‰€ *</label>
                            <input type="text" id="projectLocation" required placeholder="ä¾‹: å‚äº•å¸‚ æ˜¥æ±Ÿç”º é‡åŸä»– åœ°ä¿‚">
                        </div>
                        <div class="form-group">
                            <label for="contractorName">è«‹è² è€…åç§° *</label>
                            <input type="text" id="contractorName" required placeholder="ä¾‹: ãˆ±è±Šå²¡å·¥å‹™åº—">
                        </div>
                        <button type="submit" class="btn">â• å·¥äº‹ã‚’ç™»éŒ²</button>
                    </form>
                </div>

                <div class="section">
                    <h2>ç™»éŒ²æ¸ˆã¿å·¥äº‹ä¸€è¦§</h2>
                    <ul class="master-list" id="projectList"></ul>
                </div>
            </div>

            <!-- ã‚¿ãƒ–3: æ‹…å½“è€…ãƒã‚¹ã‚¿ãƒ¼ -->
            <div class="tab-content" id="tab-2">
                <div class="section">
                    <h2>æ‹…å½“è€…ãƒã‚¹ã‚¿ãƒ¼ç™»éŒ²</h2>
                    <form id="personForm" onsubmit="addPerson(event)">
                        <div class="form-group">
                            <label for="personName">æ‹…å½“è€…å *</label>
                            <input type="text" id="personName" required placeholder="ä¾‹: å±±ç”° å¤ªéƒ">
                        </div>
                        <div class="form-group">
                            <label for="personPosition">å½¹è·</label>
                            <input type="text" id="personPosition" placeholder="ä¾‹: ç¾å ´ä¸»ä»»">
                        </div>
                        <button type="submit" class="btn">â• æ‹…å½“è€…ã‚’ç™»éŒ²</button>
                    </form>
                </div>

                <div class="section">
                    <h2>ç™»éŒ²æ¸ˆã¿æ‹…å½“è€…ä¸€è¦§</h2>
                    <ul class="master-list" id="personList"></ul>
                </div>
            </div>

            <!-- ã‚¿ãƒ–4: ç‚¹æ¤œå…¥åŠ› -->
            <div class="tab-content" id="tab-3">
                <div class="section">
                    <h2>ç‚¹æ¤œæƒ…å ±å…¥åŠ›</h2>
                    <div class="form-group">
                        <label for="inspectionProject">å·¥äº‹é¸æŠ *</label>
                        <select id="inspectionProject" required onchange="updateProjectInfo()">
                            <option value="">--- å·¥äº‹ã‚’é¸æŠ ---</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inspectionMachine">ç‚¹æ¤œå¯¾è±¡æ©Ÿæ¢° *</label>
                        <select id="inspectionMachine" required>
                            <option value="">--- æ©Ÿæ¢°ã‚’é¸æŠ ---</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="inspectionDate">ç‚¹æ¤œæ—¥ *</label>
                        <input type="date" id="inspectionDate" required>
                    </div>
                    <div class="form-group">
                        <label for="inspectionPerson">æ‹…å½“è€…</label>
                        <select id="inspectionPerson">
                            <option value="">--- æ‹…å½“è€…ã‚’é¸æŠ ---</option>
                        </select>
                    </div>
                </div>

                <div class="section">
                    <h2>ç‚¹æ¤œé …ç›®</h2>
                    <div style="margin-bottom: 15px;">
                        <button class="btn btn-success" onclick="setAllChecks('â—‹')">âœ… å…¨ã¦â—‹ã«ã™ã‚‹</button>
                        <button class="btn btn-danger" onclick="setAllChecks('Ã—')">âŒ å…¨ã¦Ã—ã«ã™ã‚‹</button>
                        <button class="btn btn-warning" onclick="setAllChecks('ï¼')">â– å…¨ã¦ï¼ã«ã™ã‚‹</button>
                        <button class="btn btn-secondary" onclick="setAllChecks('')">ğŸ”„ å…¨ã¦ã‚¯ãƒªã‚¢</button>
                    </div>
                    <div class="inspection-form" id="inspectionItems"></div>
                    <button class="btn" onclick="saveInspection()">ğŸ’¾ ç‚¹æ¤œçµæœã‚’ä¿å­˜</button>
                    <button class="btn btn-secondary" onclick="clearInspectionForm()">ğŸ”„ ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢</button>
                </div>
            </div>

            <!-- ã‚¿ãƒ–5: æœˆæ¬¡ç‚¹æ¤œç°¿ -->
            <div class="tab-content" id="tab-4">
                <div class="section no-print">
                    <h2>è¡¨ç¤ºè¨­å®š</h2>
                    <div class="filters">
                        <div class="form-group">
                            <label for="reportProject">å·¥äº‹é¸æŠ</label>
                            <select id="reportProject" onchange="generateReport()">
                                <option value="">--- ã™ã¹ã¦ ---</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportMachine">æ©Ÿæ¢°é¸æŠ</label>
                            <select id="reportMachine" onchange="generateReport()">
                                <option value="">--- ã™ã¹ã¦ ---</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="reportYear">å¹´</label>
                            <input type="number" id="reportYear" value="2025" onchange="generateReport()">
                        </div>
                        <div class="form-group">
                            <label for="reportMonth">æœˆ</label>
                            <select id="reportMonth" onchange="generateReport()">
                                <option value="1">1æœˆ</option>
                                <option value="2">2æœˆ</option>
                                <option value="3">3æœˆ</option>
                                <option value="4">4æœˆ</option>
                                <option value="5">5æœˆ</option>
                                <option value="6">6æœˆ</option>
                                <option value="7">7æœˆ</option>
                                <option value="8">8æœˆ</option>
                                <option value="9">9æœˆ</option>
                                <option value="10">10æœˆ</option>
                                <option value="11">11æœˆ</option>
                                <option value="12">12æœˆ</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="window.print()">ğŸ–¨ï¸ å°åˆ·ã™ã‚‹</button>
                    <button class="btn btn-excel" onclick="exportToExcel()">ğŸ“Š Excelã§å‡ºåŠ›</button>
                    <button class="btn" style="background: linear-gradient(135deg, #00d2ff 0%, #3a47d5 100%);" onclick="shareData()">ğŸ“¤ 1ã‚¯ãƒªãƒƒã‚¯å…±æœ‰</button>
                    <button class="btn btn-secondary" onclick="exportData()">ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¿å­˜</button>
                    <button class="btn btn-warning" onclick="importData()">ğŸ“¥ ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€</button>
                    <button class="btn" style="background: linear-gradient(135deg, #00c6ff 0%, #0072ff 100%);" onclick="mergeData()">ğŸ”„ ãƒ‡ãƒ¼ã‚¿ã‚’çµåˆ</button>
                    <button class="btn btn-danger" onclick="clearAllData()">ğŸ—‘ï¸ å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤</button>
                </div>

                <div id="reportContainer"></div>
            </div>
        </div>
    </div>
</div>

<!-- ã‚¹ãƒ¯ã‚¤ãƒ—ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
<div class="swipe-navigation" id="swipeNavigation">
    <button class="swipe-btn" id="prevPageBtn" onclick="changePage(-1)">â—€</button>
    <div class="swipe-info">
        <span id="currentPageNum">1</span> / <span id="totalPageNum">1</span>
    </div>
    <button class="swipe-btn" id="nextPageBtn" onclick="changePage(1)">â–¶</button>
</div>

<!-- ã‚¯ã‚¤ãƒƒã‚¯å…±æœ‰ãƒœã‚¿ãƒ³ï¼ˆã‚¹ãƒãƒ›ç”¨ï¼‰ -->
<button class="quick-share-btn" onclick="shareData()" title="ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰">
    ğŸ“¤
</button>

<!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">ç·¨é›†</h2>
        </div>
        <div id="modalBody"></div>
        <div class="modal-footer">
            <button class="btn" onclick="saveEdit()">ğŸ’¾ ä¿å­˜</button>
            <button class="btn btn-secondary" onclick="closeModal()">âœ–ï¸ ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </div>
    </div>
</div>

<script>
    // ç‚¹æ¤œé …ç›®ã®å®šç¾©
    const inspectionItems = [
        {
            category: 'ã‚¨ãƒ³ã‚¸ãƒ³',
            items: [
                { subCategory: 'æœ¬ä½“', item: 'ã‹ã‹ã‚Šå…·åˆ', description: 'é‡ããªã„ã‹' },
                { subCategory: 'æœ¬ä½“', item: 'ç•°éŸ³', description: 'ãƒ™ãƒ«ãƒˆã®æ»‘ã‚‹éŸ³' },
                { subCategory: 'æœ¬ä½“', item: 'æ’æ°—è‰²', description: 'é’ç™½ããªã„ã‹' },
                { subCategory: 'æœ¬ä½“', item: 'æ’æ°—éŸ³', description: 'ä¸€å®šã§ã‚ã‚‹ã‹' },
                { subCategory: 'ç‡ƒæ–™è£…ç½®', item: 'æ²¹æ¼ã‚Œ', description: 'å‘¨å›²ã®ç¢ºèª' },
                { subCategory: 'å†·å´è£…ç½®', item: 'æ°´é‡ãƒ»æ°´æ¼ã‚Œ', description: 'ç¢ºèª' },
                { subCategory: 'é›»æ°—è£…ç½®', item: 'ãƒ¢ãƒ‹ã‚¿ãƒ¼', description: 'ãƒ¢ãƒ‹ã‚¿ãƒ¼ã«ã¦ç¢ºèª' }
            ]
        },
        {
            category: 'èµ°è¡Œè£…ç½®',
            items: [
                { subCategory: 'å±¥å¸¯', item: 'äº€è£‚', description: 'ç›®è¦–ã«ã¦ç¢ºèª' },
                { subCategory: 'å±¥å¸¯', item: 'ãŸã‚ã¿', description: 'ç›®è¦–ã«ã¦ç¢ºèª' }
            ]
        },
        {
            category: 'ä½œæ¥­è£…ç½®',
            items: [
                { subCategory: 'ãƒ–ãƒ¼ãƒ ', item: 'äº€è£‚', description: 'ç›®è¦–ã«ã¦ç¢ºèª' },
                { subCategory: 'ã‚¢ãƒ¼ãƒ ', item: 'äº€è£‚', description: 'ç›®è¦–ã«ã¦ç¢ºèª' },
                { subCategory: 'ãƒã‚±ãƒƒãƒˆ', item: 'äº€è£‚', description: 'ç›®è¦–ã«ã¦ç¢ºèª' }
            ]
        },
        {
            category: 'æ²¹åœ§è£…ç½®',
            items: [
                { subCategory: 'ã‚·ãƒªãƒ³ãƒ€ãƒ¼', item: 'æ²¹æ¼ã‚Œ', description: 'ç›®è¦–ã«ã¦ç¢ºèª' },
                { subCategory: 'ä½œå‹•æ²¹é‡', item: 'æ²¹é‡', description: 'ãƒ¢ãƒ‹ã‚¿ãƒ¼ã§ç›®è¦–ã«ã¦ç¢ºèª' }
            ]
        },
        {
            category: 'å®‰å…¨è£…ç½®',
            items: [
                { subCategory: 'ãƒ¬ãƒãƒ¼ãƒ­ãƒƒã‚¯', item: 'ãƒ­ãƒƒã‚¯', description: 'ãƒ­ãƒƒã‚¯ãŒã‹ã‹ã‚‹ã‹ç¢ºèª' },
                { subCategory: 'ã‚¯ãƒ©ã‚¯ã‚·ãƒ§ãƒ³', item: 'ã‚¯ãƒ©ã‚¯ã‚·ãƒ§ãƒ³', description: 'é³´ã‚‹ã‹ç¢ºèª' },
                { subCategory: 'æ—‹å›ãƒ­ãƒƒã‚¯', item: 'ãƒ­ãƒƒã‚¯', description: 'ãƒ­ãƒƒã‚¯ãŒã‹ã‹ã‚‹ã‹ç¢ºèª' }
            ]
        }
    ];

    // ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸
    let machines = [];
    let projects = [];
    let persons = [];
    let inspections = [];
    let currentEditType = '';
    let currentEditId = '';
    let currentPage = 0;
    let totalPages = 0;

    // PWAé–¢é€£
    let deferredPrompt;

    // åˆæœŸåŒ–
    function init() {
        document.getElementById('mainApp').style.display = 'block';
        loadData();
        initApp();
        initPWA();
        initAutoBackup();
        initSwipeGestures();
        checkBackupStatus();
    }

    // ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
    function loadData() {
        machines = JSON.parse(localStorage.getItem('machines') || '[]');
        projects = JSON.parse(localStorage.getItem('projects') || '[]');
        persons = JSON.parse(localStorage.getItem('persons') || '[]');
        inspections = JSON.parse(localStorage.getItem('inspections') || '[]');
    }

    // ãƒ‡ãƒ¼ã‚¿ã®ä¿å­˜
    function saveData() {
        localStorage.setItem('machines', JSON.stringify(machines));
        localStorage.setItem('projects', JSON.stringify(projects));
        localStorage.setItem('persons', JSON.stringify(persons));
        localStorage.setItem('inspections', JSON.stringify(inspections));
        localStorage.setItem('lastSaveTime', new Date().toISOString());
    }

    // ã‚¢ãƒ—ãƒªåˆæœŸåŒ–
    function initApp() {
        renderMachineList();
        renderProjectList();
        renderPersonList();
        updateAllSelects();
        renderInspectionForm();
        
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('inspectionDate').value = today;
        
        const now = new Date();
        document.getElementById('reportYear').value = now.getFullYear();
        document.getElementById('reportMonth').value = now.getMonth() + 1;
    }

    // PWAåˆæœŸåŒ–
    function initPWA() {
        // Service Workerç™»éŒ²
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('service-worker.js')
                .then(reg => console.log('Service Workerç™»éŒ²æˆåŠŸ'))
                .catch(err => console.log('Service Workerç™»éŒ²å¤±æ•—:', err));
        }

        // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('pwaInstallBanner').classList.add('show');
        });

        document.getElementById('pwaInstallBtn').addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                document.getElementById('pwaInstallBanner').classList.remove('show');
            }
            
            deferredPrompt = null;
        });

        // ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã®å ´åˆ
        window.addEventListener('appinstalled', () => {
            document.getElementById('pwaInstallBanner').classList.remove('show');
        });
    }

    // è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—åˆæœŸåŒ–
    function initAutoBackup() {
        // 1æ—¥1å›è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
        const lastBackup = localStorage.getItem('lastBackupTime');
        const now = new Date().getTime();
        
        if (!lastBackup || (now - new Date(lastBackup).getTime()) > 24 * 60 * 60 * 1000) {
            performAutoBackup();
        }

        // 24æ™‚é–“ã”ã¨ã«ãƒã‚§ãƒƒã‚¯
        setInterval(() => {
            const lastBackup = localStorage.getItem('lastBackupTime');
            const now = new Date().getTime();
            
            if (!lastBackup || (now - new Date(lastBackup).getTime()) > 24 * 60 * 60 * 1000) {
                performAutoBackup();
            }
        }, 60 * 60 * 1000); // 1æ™‚é–“ã”ã¨ã«ãƒã‚§ãƒƒã‚¯
    }

    // è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
    function performAutoBackup() {
        const data = {
            machines: machines,
            projects: projects,
            persons: persons,
            inspections: inspections,
            exportDate: new Date().toISOString()
        };
        
        localStorage.setItem('autoBackup', JSON.stringify(data));
        localStorage.setItem('lastBackupTime', new Date().toISOString());
        
        updateBackupStatus('success', 'è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†');
    }

    // æ‰‹å‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    function manualBackup() {
        performAutoBackup();
        shareData();
    }

    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
    function checkBackupStatus() {
        const lastBackup = localStorage.getItem('lastBackupTime');
        
        if (!lastBackup) {
            updateBackupStatus('warning', 'ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æœªå®Ÿæ–½');
            return;
        }
        
        const now = new Date().getTime();
        const backupTime = new Date(lastBackup).getTime();
        const daysSince = Math.floor((now - backupTime) / (24 * 60 * 60 * 1000));
        
        if (daysSince === 0) {
            updateBackupStatus('success', 'æœ¬æ—¥ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ¸ˆã¿');
        } else if (daysSince < 7) {
            updateBackupStatus('success', `${daysSince}æ—¥å‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—`);
        } else {
            updateBackupStatus('warning', `${daysSince}æ—¥é–“ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãªã—`);
        }
    }

    // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
    function updateBackupStatus(type, message) {
        const status = document.getElementById('backupStatus');
        status.className = 'backup-status ' + type;
        status.textContent = 'ğŸ’¾ ' + message;
    }

    // ã‚¹ãƒ¯ã‚¤ãƒ—ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼åˆæœŸåŒ–
    function initSwipeGestures() {
        let startX = 0;
        let startY = 0;
        let endX = 0;
        let endY = 0;

        const reportContainer = document.getElementById('reportContainer');

        reportContainer.addEventListener('touchstart', (e) => {
            startX = e.touches[0].clientX;
            startY = e.touches[0].clientY;
        }, { passive: true });

        reportContainer.addEventListener('touchmove', (e) => {
            endX = e.touches[0].clientX;
            endY = e.touches[0].clientY;
        }, { passive: true });

        reportContainer.addEventListener('touchend', () => {
            const deltaX = endX - startX;
            const deltaY = endY - startY;

            if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 50) {
                if (deltaX > 0) {
                    changePage(-1);
                } else {
                    changePage(1);
                }
            }
        }, { passive: true });
    }

    // ãƒšãƒ¼ã‚¸å¤‰æ›´
    function changePage(direction) {
        currentPage += direction;
        
        if (currentPage < 0) currentPage = 0;
        if (currentPage >= totalPages) currentPage = totalPages - 1;
        
        updatePageDisplay();
    }

    // ãƒšãƒ¼ã‚¸è¡¨ç¤ºæ›´æ–°
    function updatePageDisplay() {
        const pages = document.querySelectorAll('.report-page');
        
        pages.forEach((page, index) => {
            page.style.display = index === currentPage ? 'block' : 'none';
        });
        
        document.getElementById('currentPageNum').textContent = currentPage + 1;
        document.getElementById('totalPageNum').textContent = totalPages;
        
        document.getElementById('prevPageBtn').disabled = currentPage === 0;
        document.getElementById('nextPageBtn').disabled = currentPage === totalPages - 1;
        
        // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤º
        const nav = document.getElementById('swipeNavigation');
        if (totalPages > 1) {
            nav.classList.add('show');
        } else {
            nav.classList.remove('show');
        }
    }

    // æ©Ÿæ¢°ã‚’è¿½åŠ 
    function addMachine(event) {
        event.preventDefault();
        
        const machine = {
            id: Date.now().toString(),
            name: document.getElementById('machineName').value,
            class: document.getElementById('machineClass').value,
            note: document.getElementById('machineNote').value,
            createdAt: new Date().toISOString()
        };
        
        machines.push(machine);
        saveData();
        renderMachineList();
        updateAllSelects();
        
        document.getElementById('machineForm').reset();
        alert('âœ… æ©Ÿæ¢°ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼');
    }

    // å·¥äº‹ã‚’è¿½åŠ 
    function addProject(event) {
        event.preventDefault();
        
        const project = {
            id: Date.now().toString(),
            name: document.getElementById('projectName').value,
            location: document.getElementById('projectLocation').value,
            contractor: document.getElementById('contractorName').value,
            createdAt: new Date().toISOString()
        };
        
        projects.push(project);
        saveData();
        renderProjectList();
        updateAllSelects();
        
        document.getElementById('projectForm').reset();
        alert('âœ… å·¥äº‹ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼');
    }

    // æ‹…å½“è€…ã‚’è¿½åŠ 
    function addPerson(event) {
        event.preventDefault();
        
        const person = {
            id: Date.now().toString(),
            name: document.getElementById('personName').value,
            position: document.getElementById('personPosition').value,
            createdAt: new Date().toISOString()
        };
        
        persons.push(person);
        saveData();
        renderPersonList();
        updateAllSelects();
        
        document.getElementById('personForm').reset();
        alert('âœ… æ‹…å½“è€…ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼');
    }

    // æ©Ÿæ¢°ãƒªã‚¹ãƒˆã®è¡¨ç¤º
    function renderMachineList() {
        const list = document.getElementById('machineList');
        
        if (machines.length === 0) {
            list.innerHTML = '<div class="alert alert-info">ã¾ã æ©Ÿæ¢°ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>';
            return;
        }
        
        list.innerHTML = machines.map(machine => `
            <li class="master-item">
                <div class="master-info">
                    <strong>${machine.name}</strong>
                    <span>éšç´š: ${machine.class}</span>
                    ${machine.note ? `<span class="detail">å‚™è€ƒ: ${machine.note}</span>` : ''}
                </div>
                <div>
                    <button class="btn btn-warning btn-small" onclick="editMachine('${machine.id}')">âœï¸ ç·¨é›†</button>
                    <button class="btn btn-danger btn-small" onclick="deleteMachine('${machine.id}')">ğŸ—‘ï¸ å‰Šé™¤</button>
                </div>
            </li>
        `).join('');
    }

    // å·¥äº‹ãƒªã‚¹ãƒˆã®è¡¨ç¤º
    function renderProjectList() {
        const list = document.getElementById('projectList');
        
        if (projects.length === 0) {
            list.innerHTML = '<div class="alert alert-info">ã¾ã å·¥äº‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>';
            return;
        }
        
        list.innerHTML = projects.map(project => `
            <li class="master-item">
                <div class="master-info">
                    <strong>${project.name}</strong>
                    <span class="detail">å·¥äº‹ç®‡æ‰€: ${project.location}</span>
                    <span class="detail">è«‹è² è€…: ${project.contractor}</span>
                </div>
                <div>
                    <button class="btn btn-warning btn-small" onclick="editProject('${project.id}')">âœï¸ ç·¨é›†</button>
                    <button class="btn btn-danger btn-small" onclick="deleteProject('${project.id}')">ğŸ—‘ï¸ å‰Šé™¤</button>
                </div>
            </li>
        `).join('');
    }

    // æ‹…å½“è€…ãƒªã‚¹ãƒˆã®è¡¨ç¤º
    function renderPersonList() {
        const list = document.getElementById('personList');
        
        if (persons.length === 0) {
            list.innerHTML = '<div class="alert alert-info">ã¾ã æ‹…å½“è€…ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>';
            return;
        }
        
        list.innerHTML = persons.map(person => `
            <li class="master-item">
                <div class="master-info">
                    <strong>${person.name}</strong>
                    ${person.position ? `<span>å½¹è·: ${person.position}</span>` : ''}
                </div>
                <div>
                    <button class="btn btn-warning btn-small" onclick="editPerson('${person.id}')">âœï¸ ç·¨é›†</button>
                    <button class="btn btn-danger btn-small" onclick="deletePerson('${person.id}')">ğŸ—‘ï¸ å‰Šé™¤</button>
                </div>
            </li>
        `).join('');
    }

    // ç·¨é›†æ©Ÿèƒ½
    function editMachine(id) {
        const machine = machines.find(m => m.id === id);
        currentEditType = 'machine';
        currentEditId = id;
        
        document.getElementById('modalTitle').textContent = 'æ©Ÿæ¢°ç·¨é›†';
        document.getElementById('modalBody').innerHTML = `
            <div class="form-group">
                <label>æ©Ÿæ¢°åç§° *</label>
                <input type="text" id="editName" value="${machine.name}" required>
            </div>
            <div class="form-group">
                <label>éšç´š *</label>
                <input type="text" id="editClass" value="${machine.class}" required>
            </div>
            <div class="form-group">
                <label>å‚™è€ƒ</label>
                <textarea id="editNote" rows="3">${machine.note || ''}</textarea>
            </div>
        `;
        
        document.getElementById('editModal').classList.add('show');
    }

    function editProject(id) {
        const project = projects.find(p => p.id === id);
        currentEditType = 'project';
        currentEditId = id;
        
        document.getElementById('modalTitle').textContent = 'å·¥äº‹ç·¨é›†';
        document.getElementById('modalBody').innerHTML = `
            <div class="form-group">
                <label>å·¥äº‹å *</label>
                <input type="text" id="editName" value="${project.name}" required>
            </div>
            <div class="form-group">
                <label>å·¥äº‹ç®‡æ‰€ *</label>
                <input type="text" id="editLocation" value="${project.location}" required>
            </div>
            <div class="form-group">
                <label>è«‹è² è€…åç§° *</label>
                <input type="text" id="editContractor" value="${project.contractor}" required>
            </div>
        `;
        
        document.getElementById('editModal').classList.add('show');
    }

    function editPerson(id) {
        const person = persons.find(p => p.id === id);
        currentEditType = 'person';
        currentEditId = id;
        
        document.getElementById('modalTitle').textContent = 'æ‹…å½“è€…ç·¨é›†';
        document.getElementById('modalBody').innerHTML = `
            <div class="form-group">
                <label>æ‹…å½“è€…å *</label>
                <input type="text" id="editName" value="${person.name}" required>
            </div>
            <div class="form-group">
                <label>å½¹è·</label>
                <input type="text" id="editPosition" value="${person.position || ''}">
            </div>
        `;
        
        document.getElementById('editModal').classList.add('show');
    }

    function saveEdit() {
        if (currentEditType === 'machine') {
            const machine = machines.find(m => m.id === currentEditId);
            machine.name = document.getElementById('editName').value;
            machine.class = document.getElementById('editClass').value;
            machine.note = document.getElementById('editNote').value;
            renderMachineList();
        } else if (currentEditType === 'project') {
            const project = projects.find(p => p.id === currentEditId);
            project.name = document.getElementById('editName').value;
            project.location = document.getElementById('editLocation').value;
            project.contractor = document.getElementById('editContractor').value;
            renderProjectList();
        } else if (currentEditType === 'person') {
            const person = persons.find(p => p.id === currentEditId);
            person.name = document.getElementById('editName').value;
            person.position = document.getElementById('editPosition').value;
            renderPersonList();
        }
        
        saveData();
        updateAllSelects();
        closeModal();
        alert('âœ… æ›´æ–°ã—ã¾ã—ãŸï¼');
    }

    function closeModal() {
        document.getElementById('editModal').classList.remove('show');
    }

    // å‰Šé™¤æ©Ÿèƒ½
    function deleteMachine(id) {
        if (!confirm('ã“ã®æ©Ÿæ¢°ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\né–¢é€£ã™ã‚‹ç‚¹æ¤œè¨˜éŒ²ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) return;
        machines = machines.filter(m => m.id !== id);
        inspections = inspections.filter(i => i.machineId !== id);
        saveData();
        renderMachineList();
        updateAllSelects();
    }

    function deleteProject(id) {
        if (!confirm('ã“ã®å·¥äº‹ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\né–¢é€£ã™ã‚‹ç‚¹æ¤œè¨˜éŒ²ã‚‚å‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) return;
        projects = projects.filter(p => p.id !== id);
        inspections = inspections.filter(i => i.projectId !== id);
        saveData();
        renderProjectList();
        updateAllSelects();
    }

    function deletePerson(id) {
        if (!confirm('ã“ã®æ‹…å½“è€…ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
        persons = persons.filter(p => p.id !== id);
        saveData();
        renderPersonList();
    }

    // ã™ã¹ã¦ã®é¸æŠãƒªã‚¹ãƒˆã‚’æ›´æ–°
    function updateAllSelects() {
        updateMachineSelects();
        updateProjectSelects();
        updatePersonSelects();
    }

    function updateMachineSelects() {
        const selects = [
            document.getElementById('inspectionMachine'),
            document.getElementById('reportMachine')
        ];
        
        selects.forEach(select => {
            const currentValue = select.value;
            const isInspectionSelect = select.id === 'inspectionMachine';
            
            select.innerHTML = isInspectionSelect 
                ? '<option value="">--- æ©Ÿæ¢°ã‚’é¸æŠ ---</option>'
                : '<option value="">--- ã™ã¹ã¦ ---</option>';
            
            machines.forEach(machine => {
                const option = document.createElement('option');
                option.value = machine.id;
                option.textContent = `${machine.name} (${machine.class})`;
                select.appendChild(option);
            });
            
            select.value = currentValue;
        });
    }

    function updateProjectSelects() {
        const selects = [
            document.getElementById('inspectionProject'),
            document.getElementById('reportProject')
        ];
        
        selects.forEach(select => {
            const currentValue = select.value;
            const isInspectionSelect = select.id === 'inspectionProject';
            
            select.innerHTML = isInspectionSelect 
                ? '<option value="">--- å·¥äº‹ã‚’é¸æŠ ---</option>'
                : '<option value="">--- ã™ã¹ã¦ ---</option>';
            
            projects.forEach(project => {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.name;
                select.appendChild(option);
            });
            
            select.value = currentValue;
        });
    }

    function updatePersonSelects() {
        const select = document.getElementById('inspectionPerson');
        const currentValue = select.value;
        
        select.innerHTML = '<option value="">--- æ‹…å½“è€…ã‚’é¸æŠ ---</option>';
        
        persons.forEach(person => {
            const option = document.createElement('option');
            option.value = person.id;
            option.textContent = person.position ? `${person.name} (${person.position})` : person.name;
            select.appendChild(option);
        });
        
        select.value = currentValue;
    }

    function updateProjectInfo() {}

    // ç‚¹æ¤œãƒ•ã‚©ãƒ¼ãƒ ã®ç”Ÿæˆ
    function renderInspectionForm() {
        const container = document.getElementById('inspectionItems');
        
        container.innerHTML = inspectionItems.map(category => `
            <div class="inspection-category">
                <h3>${category.category}</h3>
                ${category.items.map((item, index) => `
                    <div class="inspection-item">
                        <label>${item.subCategory} - ${item.item}</label>
                        <span class="check-description">${item.description}</span>
                        <select id="check_${category.category}_${index}">
                            <option value="">---</option>
                            <option value="â—‹">â—‹ (è‰¯å¥½)</option>
                            <option value="Ã—">Ã— (ä¸è‰¯)</option>
                            <option value="ï¼">ï¼ (è©²å½“ãªã—)</option>
                        </select>
                    </div>
                `).join('')}
            </div>
        `).join('');
    }

    // ç‚¹æ¤œçµæœã‚’ä¿å­˜
    function saveInspection() {
        const projectId = document.getElementById('inspectionProject').value;
        const machineId = document.getElementById('inspectionMachine').value;
        const date = document.getElementById('inspectionDate').value;
        const personId = document.getElementById('inspectionPerson').value;
        
        if (!projectId || !machineId || !date) {
            alert('âŒ å·¥äº‹ã€æ©Ÿæ¢°ã€ç‚¹æ¤œæ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            return;
        }
        
        const results = {};
        inspectionItems.forEach(category => {
            category.items.forEach((item, index) => {
                const key = `${category.category}_${index}`;
                const value = document.getElementById(`check_${key}`).value;
                if (value) {
                    results[key] = value;
                }
            });
        });
        
        inspections = inspections.filter(i => 
            !(i.projectId === projectId && i.machineId === machineId && i.date === date)
        );
        
        const inspection = {
            id: Date.now().toString(),
            projectId: projectId,
            machineId: machineId,
            date: date,
            personId: personId,
            results: results,
            createdAt: new Date().toISOString()
        };
        
        inspections.push(inspection);
        saveData();
        
        alert('âœ… ç‚¹æ¤œçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
    }

    function clearInspectionForm() {
        document.querySelectorAll('[id^="check_"]').forEach(select => {
            select.value = '';
        });
    }

    // å…¨ã¦ã®ç‚¹æ¤œé …ç›®ã‚’ä¸€æ‹¬è¨­å®š
    function setAllChecks(value) {
        const selectElements = document.querySelectorAll('[id^="check_"]');
        let count = 0;
        
        selectElements.forEach(select => {
            select.value = value;
            count++;
        });
        
        const valueText = {
            'â—‹': 'â—‹ (è‰¯å¥½)',
            'Ã—': 'Ã— (ä¸è‰¯)',
            'ï¼': 'ï¼ (è©²å½“ãªã—)',
            '': 'ã‚¯ãƒªã‚¢'
        };
        
        alert(`âœ… ${count}é …ç›®ã‚’ã€Œ${valueText[value]}ã€ã«è¨­å®šã—ã¾ã—ãŸï¼`);
    }

    // Excelã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
    function exportToExcel() {
        const projectId = document.getElementById('reportProject').value;
        const machineId = document.getElementById('reportMachine').value;
        const year = parseInt(document.getElementById('reportYear').value);
        const month = parseInt(document.getElementById('reportMonth').value);
        
        if (machines.length === 0 || projects.length === 0) {
            alert('âŒ æ©Ÿæ¢°ã¾ãŸã¯å·¥äº‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚');
            return;
        }
        
        const targetProjects = projectId ? projects.filter(p => p.id === projectId) : projects;
        const targetMachines = machineId ? machines.filter(m => m.id === machineId) : machines;
        
        const workbook = XLSX.utils.book_new();
        
        targetProjects.forEach(project => {
            targetMachines.forEach(machine => {
                const monthInspections = inspections.filter(i => {
                    if (i.projectId !== project.id || i.machineId !== machine.id) return false;
                    const inspDate = new Date(i.date);
                    return inspDate.getFullYear() === year && inspDate.getMonth() + 1 === month;
                });
                
                if (monthInspections.length === 0 && !projectId && !machineId) return;
                
                const sheetData = generateExcelData(project, machine, year, month, monthInspections);
                const worksheet = XLSX.utils.aoa_to_sheet(sheetData);
                
                // åˆ—å¹…è¨­å®š
                worksheet['!cols'] = [
                    { wch: 10 },  // å¤§åˆ†é¡
                    { wch: 12 },  // ä¸­åˆ†é¡
                    { wch: 30 },  // ç‚¹æ¤œé …ç›®
                    ...Array(31).fill({ wch: 4 })  // æ—¥ä»˜
                ];
                
                const sheetName = `${machine.name.substring(0, 15)}_${month}æœˆ`;
                XLSX.utils.book_append_sheet(workbook, worksheet, sheetName);
            });
        });
        
        const fileName = `ç‚¹æ¤œè¨˜éŒ²_${year}å¹´${month}æœˆ_${new Date().toISOString().split('T')[0]}.xlsx`;
        XLSX.writeFile(workbook, fileName);
        
        alert('âœ… Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼');
    }

    // Excelç”¨ãƒ‡ãƒ¼ã‚¿ç”Ÿæˆ
    function generateExcelData(project, machine, year, month, monthInspections) {
        const daysInMonth = new Date(year, month, 0).getDate();
        const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
        
        const data = [];
        
        // ã‚¿ã‚¤ãƒˆãƒ«
        data.push(['å»ºè¨­æ©Ÿæ¢°ä½¿ç”¨å‰ç‚¹æ¤œè¨˜éŒ²']);
        data.push([]);
        
        // å·¥äº‹æƒ…å ±
        data.push(['å·¥äº‹å', project.name, '', '', 'è«‹è² è€…åç§°', project.contractor]);
        data.push(['å·¥äº‹ç®‡æ‰€', project.location, '', '', 'å¯¾è±¡å¹´æœˆ', `${year}å¹´${month}æœˆ`]);
        data.push([]);
        
        // æ©Ÿæ¢°æƒ…å ±
        data.push(['æ©Ÿæ¢°åç§°', `${machine.name} (${machine.class})`]);
        data.push([]);
        
        // ãƒ˜ãƒƒãƒ€ãƒ¼
        const header1 = ['å¤§åˆ†é¡', 'ä¸­åˆ†é¡', 'ç‚¹æ¤œé …ç›®'];
        const halfDayIndex = Math.ceil(daysInMonth / 2);
        header1.push(...Array(halfDayIndex).fill('ä¸ŠåŠæœŸ'));
        header1.push(...Array(daysInMonth - halfDayIndex).fill('ä¸‹åŠæœŸ'));
        data.push(header1);
        
        const header2 = ['', '', ''];
        header2.push(...days);
        data.push(header2);
        
        // ç‚¹æ¤œé …ç›®
        inspectionItems.forEach(category => {
            category.items.forEach((item, itemIndex) => {
                const row = [];
                
                if (itemIndex === 0) {
                    row.push(category.category);
                } else {
                    row.push('');
                }
                
                row.push(item.subCategory);
                row.push(`${item.item}\n${item.description}`);
                
                const key = `${category.category}_${itemIndex}`;
                
                days.forEach(day => {
                    const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const inspection = monthInspections.find(i => i.date === dateStr);
                    const value = inspection?.results[key] || '';
                    row.push(value);
                });
                
                data.push(row);
            });
        });
        
        // æ‹…å½“è€…è¡Œ
        const personRow = ['', '', 'æ‹…å½“è€…'];
        days.forEach(day => {
            const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const inspection = monthInspections.find(i => i.date === dateStr);
            let personName = '';
            if (inspection && inspection.personId) {
                const person = persons.find(p => p.id === inspection.personId);
                personName = person ? person.name : '';
            }
            personRow.push(personName);
        });
        data.push(personRow);
        
        return data;
    }

    // 1ã‚¯ãƒªãƒƒã‚¯å…±æœ‰æ©Ÿèƒ½
    async function shareData() {
        const data = {
            machines: machines,
            projects: projects,
            persons: persons,
            inspections: inspections,
            exportDate: new Date().toISOString()
        };
        
        const jsonString = JSON.stringify(data, null, 2);
        const fileName = `ç‚¹æ¤œç°¿ãƒ‡ãƒ¼ã‚¿_${new Date().toISOString().split('T')[0]}.json`;
        
        // Web Share APIå¯¾å¿œãƒã‚§ãƒƒã‚¯
        if (navigator.share && navigator.canShare) {
            try {
                // Blobã‚’ä½œæˆ
                const blob = new Blob([jsonString], { type: 'application/json' });
                const file = new File([blob], fileName, { type: 'application/json' });
                
                // å…±æœ‰å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                if (navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        title: 'å»ºè¨­æ©Ÿæ¢°ç‚¹æ¤œè¨˜éŒ²ãƒ‡ãƒ¼ã‚¿',
                        text: `ç‚¹æ¤œè¨˜éŒ²ãƒ‡ãƒ¼ã‚¿ï¼ˆ${machines.length}å°ã®æ©Ÿæ¢°ã€${projects.length}ä»¶ã®å·¥äº‹ã€${inspections.length}ä»¶ã®è¨˜éŒ²ï¼‰`,
                        files: [file]
                    });
                    
                    alert('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’å…±æœ‰ã—ã¾ã—ãŸï¼');
                    
                    // å…±æœ‰ã—ãŸã®ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨˜éŒ²ã‚’æ›´æ–°
                    localStorage.setItem('lastBackupTime', new Date().toISOString());
                    updateBackupStatus('success', 'å…±æœ‰å®Œäº†');
                    
                    return;
                }
            } catch (error) {
                if (error.name !== 'AbortError') {
                    console.log('Web Share API ã‚¨ãƒ©ãƒ¼:', error);
                } else {
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ãŸ
                    return;
                }
            }
        }
        
        // Web Share APIéå¯¾å¿œã®å ´åˆã¯ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ + ã‚³ãƒ”ãƒ¼
        if (!navigator.share) {
            // è‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.click();
            URL.revokeObjectURL(url);
            
            // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚‚ã‚³ãƒ”ãƒ¼ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦ï¼‰
            if (navigator.clipboard) {
                try {
                    await navigator.clipboard.writeText(jsonString);
                    alert('âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã€ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼\n\nLINEãªã©ã§å…±æœ‰ã™ã‚‹å ´åˆï¼š\n1. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ·»ä»˜ã€ã¾ãŸã¯\n2. ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰è²¼ã‚Šä»˜ã‘');
                } catch (err) {
                    alert('âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼\nã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’LINEã‚„ãƒ¡ãƒ¼ãƒ«ã§å…±æœ‰ã—ã¦ãã ã•ã„ã€‚');
                }
            } else {
                alert('âœ… ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼\nã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’LINEã‚„ãƒ¡ãƒ¼ãƒ«ã§å…±æœ‰ã—ã¦ãã ã•ã„ã€‚');
            }
            
            // ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—è¨˜éŒ²ã‚’æ›´æ–°
            localStorage.setItem('lastBackupTime', new Date().toISOString());
            updateBackupStatus('success', 'ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†');
        }
    }

    // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆå¾“æ¥ã®æ–¹æ³•ï¼‰
    function exportData() {
        const data = {
            machines: machines,
            projects: projects,
            persons: persons,
            inspections: inspections,
            exportDate: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ç‚¹æ¤œç°¿ãƒ‡ãƒ¼ã‚¿_${new Date().toISOString().split('T')[0]}.json`;
        a.click();
        URL.revokeObjectURL(url);
        
        alert('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸï¼\nã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’LINEã§é€ã‚Œã°ã€ä»–ã®äººã‚‚èª­ã¿è¾¼ã‚ã¾ã™ã€‚');
    }

    // ãƒ‡ãƒ¼ã‚¿ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
    function importData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'application/json';
        input.onchange = (e) => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    
                    const confirmMessage = `ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚\n\n` +
                        `æ©Ÿæ¢°: ${data.machines?.length || 0}ä»¶\n` +
                        `å·¥äº‹: ${data.projects?.length || 0}ä»¶\n` +
                        `æ‹…å½“è€…: ${data.persons?.length || 0}ä»¶\n` +
                        `ç‚¹æ¤œè¨˜éŒ²: ${data.inspections?.length || 0}ä»¶\n\n` +
                        `æ—¢å­˜ã®ãƒ‡ãƒ¼ã‚¿ã¯ä¸Šæ›¸ãã•ã‚Œã¾ã™ã€‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`;
                    
                    if (confirm(confirmMessage)) {
                        machines = data.machines || [];
                        projects = data.projects || [];
                        persons = data.persons || [];
                        inspections = data.inspections || [];
                        
                        saveData();
                        renderMachineList();
                        renderProjectList();
                        renderPersonList();
                        updateAllSelects();
                        
                        alert('âœ… ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼');
                    }
                } catch (error) {
                    alert('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚\nJSONå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                    console.error('ã‚¤ãƒ³ãƒãƒ¼ãƒˆã‚¨ãƒ©ãƒ¼:', error);
                }
            };
            reader.readAsText(file);
        };
        input.click();
    }

    // ãƒ‡ãƒ¼ã‚¿çµåˆæ©Ÿèƒ½
    function mergeData() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'application/json';
        input.multiple = true;
        
        input.onchange = async (e) => {
            const files = Array.from(e.target.files);
            
            if (files.length === 0) return;
            
            try {
                const allData = [];
                
                for (const file of files) {
                    const text = await readFileAsText(file);
                    const data = JSON.parse(text);
                    allData.push({
                        filename: file.name,
                        data: data
                    });
                }
                
                const merged = mergeMultipleData(allData);
                
                const currentTotal = {
                    machines: machines.length,
                    projects: projects.length,
                    persons: persons.length,
                    inspections: inspections.length
                };
                
                const confirmMessage = `${files.length}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆã—ã¾ã™ã€‚\n\n` +
                    `ã€ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã€‘\n` +
                    `æ©Ÿæ¢°: ${currentTotal.machines}ä»¶\n` +
                    `å·¥äº‹: ${currentTotal.projects}ä»¶\n` +
                    `æ‹…å½“è€…: ${currentTotal.persons}ä»¶\n` +
                    `ç‚¹æ¤œè¨˜éŒ²: ${currentTotal.inspections}ä»¶\n\n` +
                    `ã€çµåˆå¾Œã®ãƒ‡ãƒ¼ã‚¿ã€‘\n` +
                    `æ©Ÿæ¢°: ${merged.machines.length}ä»¶ (+${merged.machines.length - currentTotal.machines}ä»¶)\n` +
                    `å·¥äº‹: ${merged.projects.length}ä»¶ (+${merged.projects.length - currentTotal.projects}ä»¶)\n` +
                    `æ‹…å½“è€…: ${merged.persons.length}ä»¶ (+${merged.persons.length - currentTotal.persons}ä»¶)\n` +
                    `ç‚¹æ¤œè¨˜éŒ²: ${merged.inspections.length}ä»¶ (+${merged.inspections.length - currentTotal.inspections}ä»¶)\n\n` +
                    `â€»é‡è¤‡ãƒ‡ãƒ¼ã‚¿ã¯è‡ªå‹•çš„ã«çµ±åˆã•ã‚Œã¾ã™ã€‚\nã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ`;
                
                if (confirm(confirmMessage)) {
                    machines = merged.machines;
                    projects = merged.projects;
                    persons = merged.persons;
                    inspections = merged.inspections;
                    
                    saveData();
                    renderMachineList();
                    renderProjectList();
                    renderPersonList();
                    updateAllSelects();
                    
                    alert(`âœ… ${files.length}å€‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆã—ã¾ã—ãŸï¼\n\n` +
                        `æ©Ÿæ¢°: ${merged.machines.length}ä»¶\n` +
                        `å·¥äº‹: ${merged.projects.length}ä»¶\n` +
                        `æ‹…å½“è€…: ${merged.persons.length}ä»¶\n` +
                        `ç‚¹æ¤œè¨˜éŒ²: ${merged.inspections.length}ä»¶`);
                }
                
            } catch (error) {
                alert('âŒ ãƒ•ã‚¡ã‚¤ãƒ«ã®çµåˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚\næ­£ã—ã„JSONå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚');
                console.error('çµåˆã‚¨ãƒ©ãƒ¼:', error);
            }
        };
        
        input.click();
    }

    function readFileAsText(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = (e) => resolve(e.target.result);
            reader.onerror = (e) => reject(e);
            reader.readAsText(file);
        });
    }

    function mergeMultipleData(dataList) {
        let mergedMachines = [...machines];
        let mergedProjects = [...projects];
        let mergedPersons = [...persons];
        let mergedInspections = [...inspections];
        
        dataList.forEach(item => {
            const data = item.data;
            
            if (data.machines) {
                data.machines.forEach(machine => {
                    if (!mergedMachines.find(m => m.id === machine.id)) {
                        mergedMachines.push(machine);
                    }
                });
            }
            
            if (data.projects) {
                data.projects.forEach(project => {
                    if (!mergedProjects.find(p => p.id === project.id)) {
                        mergedProjects.push(project);
                    }
                });
            }
            
            if (data.persons) {
                data.persons.forEach(person => {
                    if (!mergedPersons.find(p => p.id === person.id)) {
                        mergedPersons.push(person);
                    }
                });
            }
            
            if (data.inspections) {
                data.inspections.forEach(inspection => {
                    const existingIndex = mergedInspections.findIndex(i => 
                        i.projectId === inspection.projectId && 
                        i.machineId === inspection.machineId && 
                        i.date === inspection.date
                    );
                    
                    if (existingIndex === -1) {
                        mergedInspections.push(inspection);
                    } else {
                        const existing = mergedInspections[existingIndex];
                        const existingTime = new Date(existing.createdAt || 0);
                        const newTime = new Date(inspection.createdAt || 0);
                        
                        if (newTime > existingTime) {
                            mergedInspections[existingIndex] = inspection;
                        }
                    }
                });
            }
        });
        
        return {
            machines: mergedMachines,
            projects: mergedProjects,
            persons: mergedPersons,
            inspections: mergedInspections
        };
    }

    // å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
    function clearAllData() {
        if (!confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) return;
        if (!confirm('æœ¬å½“ã«å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ\nã™ã¹ã¦ã®ãƒã‚¹ã‚¿ãƒ¼ã¨ç‚¹æ¤œè¨˜éŒ²ãŒå‰Šé™¤ã•ã‚Œã¾ã™ã€‚')) return;
        
        machines = [];
        projects = [];
        persons = [];
        inspections = [];
        saveData();
        
        renderMachineList();
        renderProjectList();
        renderPersonList();
        updateAllSelects();
        document.getElementById('reportContainer').innerHTML = '';
        
        alert('âœ… ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚');
    }

    // æœˆæ¬¡ãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
    function generateReport() {
        const projectId = document.getElementById('reportProject').value;
        const machineId = document.getElementById('reportMachine').value;
        const year = parseInt(document.getElementById('reportYear').value);
        const month = parseInt(document.getElementById('reportMonth').value);
        
        const container = document.getElementById('reportContainer');
        
        if (machines.length === 0 || projects.length === 0) {
            container.innerHTML = '<div class="alert alert-info">æ©Ÿæ¢°ã¾ãŸã¯å·¥äº‹ãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</div>';
            return;
        }
        
        const targetProjects = projectId ? projects.filter(p => p.id === projectId) : projects;
        const targetMachines = machineId ? machines.filter(m => m.id === machineId) : machines;
        
        container.innerHTML = '';
        
        let pageIndex = 0;
        
        targetProjects.forEach(project => {
            targetMachines.forEach(machine => {
                const monthInspections = inspections.filter(i => {
                    if (i.projectId !== project.id || i.machineId !== machine.id) return false;
                    const inspDate = new Date(i.date);
                    return inspDate.getFullYear() === year && inspDate.getMonth() + 1 === month;
                });
                
                if (monthInspections.length === 0 && !projectId && !machineId) return;
                
                const daysInMonth = new Date(year, month, 0).getDate();
                const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
                const halfDayIndex = Math.ceil(daysInMonth / 2);
                
                const page = document.createElement('div');
                page.className = 'report-page';
                
                page.innerHTML = `
                    <div class="report-title">å»ºè¨­æ©Ÿæ¢°ä½¿ç”¨å‰ç‚¹æ¤œè¨˜éŒ²</div>
                    
                    <table class="report-info-table">
                        <tr>
                            <td class="label">å·¥äº‹å</td>
                            <td colspan="3">${project.name}</td>
                            <td class="label">è«‹è² è€…åç§°</td>
                            <td>${project.contractor}</td>
                        </tr>
                        <tr>
                            <td class="label">å·¥äº‹ç®‡æ‰€</td>
                            <td colspan="3">${project.location}</td>
                            <td class="label">å¯¾è±¡å¹´æœˆ</td>
                            <td>${year}å¹´${month}æœˆ</td>
                        </tr>
                    </table>
                    
                    <table class="report-info-table" style="margin-bottom: 30px;">
                        <tr>
                            <td class="label">æ©Ÿæ¢°åç§°</td>
                            <td colspan="5">${machine.name} (${machine.class})</td>
                        </tr>
                    </table>
                    
                    <table class="report-main-table">
                        <thead>
                            <tr>
                                <th rowspan="2" width="60">å¤§åˆ†é¡</th>
                                <th rowspan="2" width="80">ä¸­åˆ†é¡</th>
                                <th rowspan="2" width="180">ç‚¹æ¤œé …ç›®</th>
                                <th colspan="${halfDayIndex}">ä¸ŠåŠæœŸ</th>
                                <th colspan="${daysInMonth - halfDayIndex}">ä¸‹åŠæœŸ</th>
                            </tr>
                            <tr>
                                ${days.slice(0, halfDayIndex).map(d => `<th class="day-cell">${d}</th>`).join('')}
                                ${days.slice(halfDayIndex).map(d => `<th class="day-cell">${d}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${generateInspectionRows(monthInspections, year, month, daysInMonth)}
                        </tbody>
                    </table>
                    
                    <div class="report-footer">
                        <div class="sign-row">
                            <strong>ç¢ºèªã‚µã‚¤ãƒ³</strong>
                        </div>
                        <p>Ã— ãŒã‚ã£ãŸå ´åˆã¯æ˜¯æ­£å ±å‘Šã‚’æ›¸ã</p>
                        <p>æ˜¯æ­£å‡¦ç½®å ±å‘Šæ›¸ã‚’æ›¸ã</p>
                        <p><strong>â—‹ã¯ã€ä½•ã‚‚å¤‰ã‚ã‚Šãªã—ã€€ã€€Ã—ã¯ã€æ”¹å–„ã®å‡¦ç½®ãŒå¿…è¦</strong></p>
                    </div>
                `;
                
                container.appendChild(page);
                pageIndex++;
            });
        });
        
        totalPages = pageIndex;
        currentPage = 0;
        updatePageDisplay();
    }

    function generateInspectionRows(monthInspections, year, month, daysInMonth) {
        const days = Array.from({ length: daysInMonth }, (_, i) => i + 1);
        
        let html = '';
        inspectionItems.forEach(category => {
            category.items.forEach((item, itemIndex) => {
                const isFirstInCategory = itemIndex === 0;
                const key = `${category.category}_${itemIndex}`;
                
                html += '<tr>';
                
                if (isFirstInCategory) {
                    html += `<td rowspan="${category.items.length}" class="category-cell">${category.category}</td>`;
                }
                
                html += `<td class="subcategory-cell">${item.subCategory}</td>`;
                html += `<td class="item-cell">${item.item}<br><small>${item.description}</small></td>`;
                
                days.forEach(day => {
                    const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                    const inspection = monthInspections.find(i => i.date === dateStr);
                    const value = inspection?.results[key] || '';
                    const statusClass = value === 'â—‹' ? 'status-ok' : value === 'Ã—' ? 'status-ng' : '';
                    html += `<td class="${statusClass}">${value}</td>`;
                });
                
                html += '</tr>';
            });
        });
        
        // æ‹…å½“è€…è¡Œ
        html += '<tr style="background: #fffacd;">';
        html += '<td colspan="3" class="subcategory-cell" style="text-align: center; font-weight: bold;">æ‹…å½“è€…</td>';
        days.forEach(day => {
            const dateStr = `${year}-${String(month).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
            const inspection = monthInspections.find(i => i.date === dateStr);
            let personName = '';
            if (inspection && inspection.personId) {
                const person = persons.find(p => p.id === inspection.personId);
                personName = person ? person.name : '';
            }
            html += `<td style="font-size: 10px; padding: 4px 2px;">${personName}</td>`;
        });
        html += '</tr>';
        
        return html;
    }

    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function switchTab(index) {
        document.querySelectorAll('.tab').forEach((tab, i) => {
            tab.classList.toggle('active', i === index);
        });
        
        document.querySelectorAll('.tab-content').forEach((content, i) => {
            content.classList.toggle('active', i === index);
        });
        
        if (index === 4) {
            generateReport();
        }
    }

    // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åˆæœŸåŒ–
    window.onload = init;
</script>
```

</body>
</html>